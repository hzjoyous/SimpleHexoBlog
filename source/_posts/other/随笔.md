---
title: 从数据绑定看现代库的本质（随笔）
date: '2019-06-28T23:25:00+08:00'
tags:
    - c
categories:
    - c

---


`这边文章目前没有想清楚如何表达只是作为一份草稿写来展示的`

编码中没有什么是加一层解决不了的，如果有就再加一层
<!--more-->
前端双向绑定的功能之一是由`Object.defineProperty`实现的 (可以并非唯一)

ioc 可以利用反射

闭包可以用来延迟加载

现在我们作为一个无法使用例如 vue 或者使用 lavarl 这样的框架或者库的时候我们应该如何实现类似的功能

## 双向绑定 （肤浅的例子）

监听所有的事件，在此基础上实现 set 和 get 的接口 从而实现事件的监听

## ioc 的多种实现途径 （php版本）

`控制反转（Inversion of Control，缩写为IoC），是面向对象编程中的一种设计原则，可以用来减低计算机代码之间的耦合度。其中最常见的方式叫做依赖注入（Dependency Injection，简称DI），还有一种方式叫“依赖查找”（Dependency Lookup）。通过控制反转，对象在被创建的时候，由一个调控系统内所有对象的外界实体将其所依赖的对象的引用传递给它。也可以说，依赖被注入到对象中`


- 反射类分析类整体
- 编写由php写成的语法分析器解析代码，分析出依赖的对象

控制反转容器的依赖查找即分析代码的依赖，并解决这些依赖，竟然如此其实即使没有反射api的存在，只要可以对代码进行分析就可以把依赖解决。

```php
<?php
namespace App\action;

class Cat
{
    public function eat(Food $food)
    {
        
    }
}

```
在php 框架之中大多框架的延迟加载是通过闭包实现的，下面是php延迟加载的一个简版php代码
```php
<?php

function buildLazyClass($className,$params)
{
    return function () use ($className,$params){
        new $className($params);
    }
}

```


```php
<?php
$lazyFood = buildLazyClass('Food')
if(is_callback($lazyFood)){
    return $lazyFood();
} else {
    return $lazyFood;
}
```
## 构建延迟加载 

如果一个语言没有实现闭包呢？ 那就只能自己想办法实现了
现在第一步用反射类或者语法分析器分解目标类，分析出依赖的对象，第二部是构建延迟加载类，例如下面
```php
<?php
class LazyFood 
{
    private $isBuild = false;
    private $food = null;

    public getFood()
    {
        if($this->isBuild) {
            return $food;
        } else {
            $this->food = new Food()
            $this->build = true;
            return $this->food;
        }
    }
}
```
这样就存在相同的业务编码，实现了相同的功能，相比之下如果使用了编译代码这一步，就可以想办法将执行代码中对依赖的分析解除，从而达到更高的效率









