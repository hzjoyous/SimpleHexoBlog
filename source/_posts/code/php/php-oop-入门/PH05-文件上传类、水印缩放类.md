---
title: 'PHP[OOPå…¥é—¨]PH05-æ–‡ä»¶ä¸Šä¼ ç±»ã€æ°´å°ç¼©æ”¾ç±»'
date: '2017-01-01T09:02:05+08:00'
tags:
    - php
categories:
    - php

---



> è¯¥éƒ¨åˆ†ä¸º php é¢å‘å¯¹è±¡çš„å…¥é—¨éƒ¨åˆ†ï¼Œè¾ƒä¸ºè‚¤æµ…ä¸”å‚æ‚è¿‡åˆ†å·²ç»ä¸æ˜¯ä¸»æµçš„çŸ¥è¯†ã€‚

> è¿™æ˜¯æˆ‘æ—©æœŸçš„ php å­¦ä¹ ç¬”è®°ï¼Œphp çš„å­¦ä¹ ç‰ˆæœ¬ç‰ˆæœ¬æ˜¯ 5.6ã€7ï¼ŒğŸŸ2020/05/06å¹´ä»æœ‰é“ç¬”è®°å¯¼å‡ºè‡³æ­¤ã€‚


day05-æ–‡ä»¶ä¸Šä¼ ç±»ã€æ°´å°ç¼©æ”¾ç±»

1ã€æ–‡ä»¶ä¸Šä¼ ç±»

formè¡¨å•æ³¨æ„äº‹é¡¹ï¼š

post enctype = \'multipart/form-data\'

\<input type=\'file\' name=\'f\'\>

\$\_FILES\[\'f\'\]

ç±»è®¾è®¡ï¼š

æˆå‘˜å±æ€§

ä¸Šä¼ è·¯å¾„

å…è®¸çš„åç¼€

å…è®¸mime

å…è®¸çš„å¤§å°

æ˜¯å¦å¯ç”¨éšæœºåå­—

å‰ç¼€ up\_ water\_ sf\_

é”™è¯¯å·ç 

é”™è¯¯ä¿¡æ¯

//å°†ä¸‹é¢çš„ä¿¡æ¯ä¿å­˜èµ·æ¥ï¼Œæ–¹ä¾¿å…¶ä»–çš„å‡½æ•°ä½¿ç”¨è€Œå·²

åŸæ–‡ä»¶å

åŸæ–‡ä»¶åç¼€

åŸæ–‡ä»¶å¤§å°

åŸæ–‡ä»¶çš„mime

æ–‡ä»¶ä¸´æ—¶è·¯å¾„

æˆå‘˜æ–¹æ³•

uploadFile(\$key)

ä¸Šä¼ é”™è¯¯ï¼š

å®˜æ–¹é”™è¯¯ï¼š123467

è‡ªå®šä¹‰é”™è¯¯ï¼š-1 -2 -3 -4 -5

ä¸Šä¼ æˆåŠŸï¼š0

é”™è¯¯ä¿¡æ¯ï¼š

2ã€æ°´å°ç¼©æ”¾ç±»(å›¾åƒç±»)

100\*100

50\*50

20\*80ï¼ˆå›¾ç‰‡ä¼šå˜å½¢ï¼Œä¸å˜å½¢ï¼‰

ç±»çš„è®¾è®¡ï¼š

æˆå‘˜å±æ€§

ä¿å­˜è·¯å¾„

æ˜¯å¦å¯ç”¨éšæœºåå­—

ä¿å­˜æ ¼å¼

æˆå‘˜æ–¹æ³•

æ°´å°ï¼ˆæ°´å°å›¾ç‰‡ï¼Œæºå›¾ç‰‡ï¼Œä½ç½®ï¼Œ é€æ˜åº¦ï¼Œ å‰ç¼€ï¼‰ water\_

ç¼©æ”¾ï¼ˆæºå›¾ç‰‡ï¼Œ å®½åº¦ï¼Œ é«˜åº¦ï¼Œ å‰ç¼€ï¼‰ sf\_

protected function kidOfImage(\$srcImg, \$size, \$imgInfo)

{

//ä¼ å…¥æ–°çš„å°ºå¯¸ï¼Œåˆ›å»ºä¸€ä¸ªæŒ‡å®šå°ºå¯¸çš„å›¾ç‰‡

\$newImg = imagecreatetruecolor(\$size\[\'old\_w\'\],
\$size\[\'old\_h\'\]);

//å®šä¹‰é€æ˜è‰²

\$otsc = imagecolortransparent(\$srcImg);

if (\$otsc \>= 0) {

//å–å¾—é€æ˜è‰²

\$transparentcolor = imagecolorsforindex(\$srcImg, \$otsc);

//åˆ›å»ºé€æ˜è‰²

\$newtransparentcolor = imagecolorallocate(

\$newImg,

\$transparentcolor\[\'red\'\],

\$transparentcolor\[\'green\'\],

\$transparentcolor\[\'blue\'\]

);

} else {

//å°†é»‘è‰²ä½œä¸ºé€æ˜è‰²ï¼Œå› ä¸ºåˆ›å»ºå›¾åƒååœ¨ç¬¬ä¸€æ¬¡åˆ†é…é¢œè‰²æ—¶èƒŒæ™¯é»˜è®¤ä¸ºé»‘è‰²

\$newtransparentcolor = imagecolorallocate(\$newImg, 0, 0, 0);

}

//èƒŒæ™¯å¡«å……é€æ˜

imagefill( \$newImg, 0, 0, \$newtransparentcolor);

imagecolortransparent(\$newImg, \$newtransparentcolor);

imagecopyresampled( \$newImg, \$srcImg, \$size\[\'x\'\],
\$size\[\'y\'\], 0, 0, \$size\[\"new\_w\"\], \$size\[\"new\_h\"\],
\$imgInfo\[\"width\"\], \$imgInfo\[\"height\"\] );

return \$newImg;

}

/\*

\$width:æœ€ç»ˆç¼©æ”¾çš„å®½åº¦

\$height:æœ€ç»ˆç¼©æ”¾çš„é«˜åº¦

\$imgInfo:åŸå§‹å›¾ç‰‡çš„å®½åº¦å’Œé«˜åº¦

\*/

protected function getNewSize(\$width, \$height, \$imgInfo)

{

\$size\[\'old\_w\'\] = \$width;

\$size\[\'old\_h\'\] = \$height;

\$scaleWidth = \$width / \$imgInfo\[\'width\'\];

\$scaleHeight = \$height / \$imgInfo\[\'height\'\];

\$scaleFinal = min(\$scaleWidth, \$scaleHeight);

\$size\[\'new\_w\'\] = round(\$imgInfo\[\'width\'\] \* \$scaleFinal);

\$size\[\'new\_h\'\] = round(\$imgInfo\[\'height\'\] \* \$scaleFinal);

if (\$scaleWidth \< \$scaleHeight) {

\$size\[\'x\'\] = 0;

\$size\[\'y\'\] = round(abs(\$size\[\'new\_h\'\] - \$height) / 2);

} else {

\$size\[\'y\'\] = 0;

\$size\[\'x\'\] = round(abs(\$size\[\'new\_w\'\] - \$width) / 2);

}

return \$size;

}
